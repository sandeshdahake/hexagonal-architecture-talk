<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/league.css">
		<link rel="stylesheet" href="css/custom.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-background="images/hexagons1.gif">
					<h1>HEXAGONAL ARCHITECTURE</h1>
					<h3>There Is No Secret Sauce</h3>
					<p>
						<small>Presentation by <a href="https://sandeshdahake.github.io/site/">Sandesh Dahake</a> </small>
					</p>				
				</section>
				<Section>
					<h2>Agenda</h2>
					<p class="fragment fade-in"> What to expect from your architecture.</p>
					<p class="fragment fade-in"> Clean Architecture & Onion Architecture</p>
					<p class="fragment fade-in"> Dependency injection</p>
					<p class="fragment fade-in"> Hexagonal Architecture</p>
					<p class="fragment fade-in"> Code</p>
					<p class="fragment fade-in"> Bonus :) </p>
					<p class="fragment fade-in"> Hexagonal Architecture Benefits</p>
					<p class="fragment fade-in"> Q&A</p>
				</Section>
				<!-- <section>
					<h2>WHY?</h2>
				</section>
				<section>
					<h3 style="font-size: larger;">Vertically Layered Architecture</p>
					<img src="images/layered.png" />
					<p style="font-size: medium;">Adapted from http://serena-yeoh.blogspot.com/2013/06/layered-architecture-for-net.html</p>
				</section> 
				<section>
					<h2>Blog Software</h2>
					<ul>
						<li class="fragment fade-in">Use Cases</li>
						<li class="fragment fade-in">User Interface</li>
						<li class="fragment fade-in">Persistence Infrastructure</li>
					</ul>
				</section>-->
				<section>
					<h2>Project Kickoff</h2>
					<ul>
						<li>Use Cases</li>
						<li>User Interface <span class="fragment fade-in"> Web-REST</span></li>
						<li>Persistence Infrastructure <span class="fragment fade-in"> My SQL</span></li>
					</ul>
				</section>
				<section data-background="images/happy.gif"></section>
				<section>
					<h2>After 1 Month...</h2>
					<ul>
						<li>Use Cases</li>
						<li>User Interface <span class="fragment fade-in" style="color: red;"> GraphQL</span></li>
						<li>Persistence Infrastructure <span class="fragment fade-in" style="color: red;" > MongoDB</span></li>
					</ul>
				</section>
				<section data-background="images/ok.gif"></section>
				<section>
					<h2>After 1 Month...</h2>
					<ul>
						<li>Use Cases</li>
						<li>User Interface<span class="fragment fade-in" style="color: red;"> Websockets</span></li>
						<li>Persistence Infrastructure <span class="fragment fade-in" style="color: red;"> AWS Storage</span></li>
					</ul>
				</section>
				<section data-background="images/frustration.gif"></section>	
				<!-- <section data-background-color="#000000">
					<img src="images/evolutionary1.png" />
				</section> -->
				<section>
					<h2>Evolutionary</h2>
					<P class="fragment fade-in" style="font-size: larger;">
							Flexible to change
					</p>
				</section>
				<section>
					<img src="images/bad1.png" alt="Snow" style="width:50%">
					</section>
				<section>
					<img src="images/bad2.png" alt="Snow" style="width:50%">
				</section>
				<section data-background-iframe="https://blog.cleancoder.com/uncle-bob/2011/09/30/Screaming-Architecture.html" data-background-interactive>
				</section>
				<section>
					<blockquote>
						&lsquo;Business Rules would make or save the business money, irrespective of whether they were implemented on a computer. They would make or save money even if they were executed manually&rsquo;
					</blockquote>
				</section>
				<section>					
					<blockquote>
						&lsquo;A good architecture allows major decisions to be deferred and a good architect maximize the number of decisions not made.&rsquo;
					</blockquote>
				</section>
				<section>
					<h2>Business-Centric</h2>
					<P class="fragment fade-in" style="color: red; font-size: larger;">
						<span class="fragment strike ">
							Instead of Infrastructure-Centric
						</span>
					</p>
				</section>
				<!-- <section>
					<h2>Mixing Domain and Infrastructure</h2>
					<p>Hard to</p>
					<p class="fragment fade-in" style="color: red;">See</p>
					<p class="fragment fade-in" style="color: red;">Test</p>
					<p class="fragment fade-in" style="color: red;">Change</p>
					<p>The Business</p>
				</section> -->

				<section data-background="#4d7e65">
					<h2>Clean ARCHITECTURE</h2>
					<p>Robert C Martin</p>
					<img src="images/clean-arc.png" />
				</section>
				<section data-background="#b5533c">
					<h2>ONION ARCHITECTURE</h2>
					<p>Jeffrey Palermo</p>
					<img src="images/onion.png" style="width: 60%;" height="60%" />
				</section>
				<section data-background="#4d7e65">
					<h2>HEXAGONAL ARCHITECTURE</h2>
					<h3>(Ports and Adapters)</h3>
					<p>Alistair Cockburn</p>
					<img src="images/hexagonal-arc.png" style="width: 50%;" height="50%" />
				</section>
				<section>
					<h2>Dependency injection</h2>
				</section>
				<section data-background="#000000">
					<img src="images/di1.png" style="width: 60%;" height="60%"/>
				</section>
				<section data-background="#000000">
					<img src="images/di2.png" style="width: 60%;" height="60%"/>
				</section>
				<section data-background="#000000">
					<img src="images/hex.png" />
				</section>
				<section>
					<h2>Demo</h2>
					<a href="https://github.com/sandeshdahake/hexagonal-architecture">https://github.com/sandeshdahake/hexagonal-architecture</a>
				</section>
				<section>
					<img src="images/code1.png" alt="Snow" style="width:50%">
				</section>
				<section>
					<section>
						<h2>Domain</h2>
					</section>
					<section>
						<img src="images/domain.png" alt="Snow"/>
					</section>
					<section>
						<h3>Lyrics Model</h3>
						<pre><code class="hljs" data-trim >
							@AllArgsConstructor
							@Builder
							@Data
							@NoArgsConstructor
							public class Lyrics {
								@NotNull
								private String lyrics;
								@NotNull
								private String participatingArtist;
							}
						</code></pre>
					</section>
					<section>
						<h3>Output Port/Secondary Port</h3>
						<pre><code class="hljs" data-trim >
							public interface LyricsPersistencePort {

								void addLyrics(Lyrics lyrics);

								void removeLyrics(Lyrics lyrics);

								void updateLyrics(Lyrics lyrics);

								List<Lyrics> getAllLyrics();

								Lyrics getLyricsById(Long lyricsId);

							}</code></pre>
					</section>	
				</section>
				<section>
					<section>
						<h2>Application</h2>
					</section>
					<section>
						<img src="images/code1.png" alt="Snow" style="width:50%">
					</section>
					<section>
						<h3>USE CASE</h3>
						<pre><code class="hljs" data-trim data-line-numbers="2-5,11-14">
							@Slf4j
							@Service
							public class AddLyricsBookmarkUseCaseImpl implements AddLyricsBookmarkUseCase {

								private final LyricsPersistencePort lyricsPersistencePort;

								public AddLyricsBookmarkUseCaseImpl(LyricsPersistencePort lyricsPersistencePort) {
									this.lyricsPersistencePort = lyricsPersistencePort;
								}

								@Override
								public void addLyrics(Lyrics lyrics) {
									lyricsPersistencePort.addLyrics(lyrics);
								}
							}
						</code><pre>
					</section>
				</section>
				
				<section>
					<section>
						<h2>Infrastructure</h2>
					</section>
					<section>
						<img src="images/infra.png" alt="Snow" style="width:50%">
					</section>
					<section>
						<h3>JPA Entity</h3>
						<pre><code class="hljs" data-trim >
							@NoArgsConstructor
							@AllArgsConstructor
							@Builder
							@Entity
							@Table(name = "LYRICS")
							@Data
							public class LyricsEntity {

								@Id
								@GeneratedValue(strategy = IDENTITY)
								@Column
								private Long lyricsId;

								@Column
								private String lyrics;

								@Column
								private String participatingArtist;

							}
						</code><pre>
					</section>
					<section>
						<h2>JPA Repository</h2>
						<pre><code class="hljs" data-trim >
							public interface LyricsRepository extends JpaRepository<LyricsEntity, Long> {

								void deleteAllByParticipatingArtist(String name);
							
								LyricsEntity findByParticipatingArtist(String Name);
							
								LyricsEntity findByLyrics(String Lyrics);
							}								
						</code><pre>
					</section>
					<section>
						<h2>Secondary Adapter/Output Adapter</h2>
						<pre><code class="hljs" data-trim data-line-numbers="2-5,11-14">
							@Service
							public class LyricsJpaAdapter implements LyricsPersistencePort {

								private LyricsRepository lyricsRepository;

								public LyricsJpaAdapter(LyricsRepository lyricsRepository) {
									this.lyricsRepository = lyricsRepository;
								}

								@Override
								public void addLyrics(Lyrics lyrics) {
									final LyricsEntity lyricsEntity = getLyricsEntity(lyrics);
									lyricsRepository.save(lyricsEntity);
								}

								@Override
								public void removeLyrics(Lyrics lyrics) {
									lyricsRepository.deleteAllByParticipatingArtist(lyrics.getParticipatingArtist());
								}

								@Override
								public void updateLyrics(Lyrics lyrics) {
									final LyricsEntity byParticipatingArtist = lyricsRepository.findByParticipatingArtist(lyrics.getParticipatingArtist());
									if (Objects.nonNull(byParticipatingArtist)) {
										byParticipatingArtist.setLyrics(lyrics.getLyrics());
										lyricsRepository.save(byParticipatingArtist);
									} else {
										final LyricsEntity byLyrics = lyricsRepository.findByLyrics(lyrics.getLyrics());
										if (Objects.nonNull(byLyrics)) {
											byLyrics.setParticipatingArtist(lyrics.getParticipatingArtist());
											lyricsRepository.save(byLyrics);
										}
									}
								}

								@Override
								public List<Lyrics> getAllLyrics() {
									return lyricsRepository.findAll()
											.stream()
											.map(this::getLyrics)
											.collect(Collectors.toList());
								}

								@SneakyThrows
								@Override
								public Lyrics getLyricsById(Long lyricsId) {
									return getLyrics(lyricsRepository.findById(lyricsId)
											.orElseThrow((Supplier<Throwable>) () -> new LyricsNotFoundException(lyricsId)));
								}

								private LyricsEntity getLyricsEntity(Lyrics lyrics) {
									return LyricsEntity.builder()
											.participatingArtist(lyrics.getParticipatingArtist())
											.lyrics(lyrics.getLyrics())
											.build();
								}

								private Lyrics getLyrics(LyricsEntity lyricsEntity) {
									return Lyrics.builder()
											.participatingArtist(lyricsEntity.getParticipatingArtist())
											.lyrics(lyricsEntity.getLyrics())
											.build();
								}

							}
						</code></pre>
					</section>
				</section>
			</section>
			<section>
				<h2>Bonus</h2>
			</section>
			<section>
				<section>
					<h2>ArchUnit</h2>
				</section>
				<section>
					<pre><code class="hljs" data-trim >
						package com.hexagonal.example.bookmarks.architecture;

						import com.tngtech.archunit.junit.AnalyzeClasses;
						import com.tngtech.archunit.junit.ArchTest;
						import com.tngtech.archunit.lang.ArchRule;

						import static com.tngtech.archunit.lang.syntax.ArchRuleDefinition.noClasses;

						@AnalyzeClasses(packages = "com.hexagonal.example.bookmarks")
						public class HexagonalArchitectureTest {
							@ArchTest
							public static final ArchRule domain_should_not_depend_on_application =
									noClasses()
											.that()
											.resideInAPackage("..domain..")
											.should()
											.dependOnClassesThat()
											.resideInAPackage("..application..");

							@ArchTest
							public static final ArchRule domain_should_not_depend_on_infrastructure =
									noClasses()
											.that()
											.resideInAPackage("..domain..")
											.should()
											.dependOnClassesThat()
											.resideInAPackage("..infrastructure..");

							@ArchTest
							public static final ArchRule domain_should_not_depend_on_ui =
									noClasses()
											.that()
											.resideInAPackage("..domain..")
											.should()
											.dependOnClassesThat()
											.resideInAPackage("..restAPI..");

							@ArchTest
							public static final ArchRule application_should_not_depend_on_infrastructure =
									noClasses()
											.that()
											.resideInAPackage("..application..")
											.should()
											.dependOnClassesThat()
											.resideInAPackage("..infrastructure..");

							@ArchTest
							public static final ArchRule application_should_not_depend_on_restAPI =
									noClasses()
											.that()
											.resideInAPackage("..application..")
											.should()
											.dependOnClassesThat()
											.resideInAPackage("..restAPI..");

							@ArchTest
							public static final ArchRule restAPI_should_not_depend_on_infrastructure =
									noClasses()
											.that()
											.resideInAPackage("..restAPI..")
											.should()
											.dependOnClassesThat()
											.resideInAPackage("..infrastructure..");
						}

					</code></pre>
				</section>
			</section>
			<section>
				<h2>Benefits of Hexagonal Architecture</h2>
				<p>Evolutionary - Flexible</p>
				<p>Business Centric</p>
				<P>Easier to test in isolation</P>
				<p>High Maintainability - Low Technical debt</p>
			</section>
			<section background="#000000">
				<p>This is just beginning....</p>
				<p>Domain Driven Design (DDD)</p>
				<p>Event Driven Architecture</p>
				<p>CQRS</p>
			</section>
			<section>
				<h2>Q&A</h2>
			</section>
			</div>
		</div>
        
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				hash: true,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/highlight/highlight.js' },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
			Reveal.configure({ transition: 'convex' })

		</script>
	</body>
</html>
